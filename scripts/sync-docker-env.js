/**
 * Docker Compose Environment Variables Synchronization Script
 * 
 * This script copies the root .env file to the Docker Compose directory,
 * ensuring that Docker Compose deployments use the same environment variables.
 */

const fs = require('fs');
const path = require('path');
const dotenv = require('dotenv');

// Load the root .env file
const rootEnvPath = path.join(__dirname, '..', '.env');
const rootEnvContent = fs.readFileSync(rootEnvPath, 'utf8');
const rootEnv = dotenv.parse(rootEnvContent);

// Create Docker Compose .env file
const dockerComposeEnvPath = path.join(__dirname, '..', 'deployment', 'docker', 'compose', '.env');
let dockerComposeEnvContent = '';

// Add a header comment
dockerComposeEnvContent += '# This file is auto-generated from the root .env file.\n';
dockerComposeEnvContent += '# Do not edit this file directly. Instead, edit the root .env file.\n';
dockerComposeEnvContent += '# Last synced: ' + new Date().toISOString() + '\n\n';

// Add all variables from the root .env file
dockerComposeEnvContent += rootEnvContent;

// Write the file
fs.writeFileSync(dockerComposeEnvPath, dockerComposeEnvContent);

console.log('Docker Compose environment variables synchronized successfully!');
console.log(`- Root .env -> ${dockerComposeEnvPath}`); 