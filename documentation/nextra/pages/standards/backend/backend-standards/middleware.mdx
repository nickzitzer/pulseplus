import { Callout, Tabs, Tab } from 'nextra/components';

# Middleware Standards

## Performance Monitoring

<Tabs items={['Requirements', 'Example']}>
  <Tab>
- All middleware must be wrapped with performance metrics
- Slow middleware execution (>100ms) must be logged
- Middleware execution counts and durations must be tracked
  </Tab>
  <Tab>
```javascript
// Wrap middleware with performance metrics
app.use(measureMiddleware(middleware, 'middlewareName'));

// For multiple middleware
const securedRoute = wrapAllMiddleware([
  authMiddleware,
  validateRequest,
  checkPermissions
], 'securedRoute');
```
  </Tab>
</Tabs>

## Version Tracking

<Tabs items={['Requirements', 'Example']}>
  <Tab>
- All middleware must be registered with version tracking
- Version history must be maintained
- Middleware changes must be auditable
  </Tab>
  <Tab>
```javascript
// Register middleware with version tracking
const authMiddleware = registerMiddleware(
  verifyToken,
  'authentication',
  { description: 'JWT authentication middleware' }
);
```
  </Tab>
</Tabs>

## Error Boundaries

<Tabs items={['Requirements', 'Example']}>
  <Tab>
- All middleware must be wrapped with error boundaries
- Middleware errors must be properly logged
- Error recovery mechanisms must be implemented
  </Tab>
  <Tab>
```javascript
// Wrap middleware with error boundary
app.use(createErrorBoundary(middleware, { 
  name: 'middlewareName',
  continueOnError: false
}));
```
  </Tab>
</Tabs>

## Health Checks

<Tabs items={['Requirements', 'Example']}>
  <Tab>
- System health check endpoint must be implemented
- Middleware-specific health check endpoint must be implemented
- Health checks must include component status
  </Tab>
  <Tab>
```javascript
// Add health check endpoints
app.get('/health', healthCheckMiddleware);
app.get('/health/middleware', middlewareHealthCheck);
```
  </Tab>
</Tabs>

<Callout type="info" emoji="ℹ️">
  Health checks are critical for automated monitoring and deployment systems. Ensure they accurately reflect the true state of your service.
</Callout> 